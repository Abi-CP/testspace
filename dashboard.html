<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      .logoutBtn {
        background-color: rgb(255, 0, 0);
      }
      .logoutBtn:hover {
        background-color: rgb(183, 0, 0);
      }
    </style>
  </head>
  <body>
    <nav>
      <h1 style="cursor: pointer" onclick="window.location.href ='/index.html'">TANCET 2024 Preparation</h1>

      <div id="navMenu">
        <button onclick="window.location.href = '/dashboard.html'">Dashboard</button>
      </div>
      <!-- Initially hidden -->
    </nav>
    <div class="sidebar" id="sidebar" style="left: -100%;">
      <ul>
        <button onclick="window.location.href='/'">Home</button>
        <button
          class="logoutBtn"
          onclick="localStorage.removeItem('token'); // Remove token from local storage
    window.location.reload()"
        >
          Log out
        </button>
        <button onclick="window.location.href = '/dashboard.html'">Dashboard</button>
      </ul>
    </div>

    <div class="hamburger" id="hamburger">&#9776;</div>

    <main>
      <h1>Welcome to the Dashboard</h1>
      <div id="userDetails">
        <!-- User details will be displayed here -->
      </div>
      <br />
      <button onclick="window.location.href='/download.html'">Download Answer Sheet</button>
      <button
        class="logoutBtn"
        onclick="localStorage.removeItem('token'); // Remove token from local storage
    window.location.reload()"
      >
        Log out
      </button>
    </main>

    <script>
      const hamburger = document.getElementById('hamburger')
      const sidebar = document.getElementById('sidebar')
      hamburger.addEventListener('click', function () {
        sidebar.style.left = sidebar.style.left === '-100%' ? '0' : '-100%'
      })
      const token = localStorage.getItem('token')
      if (!token) {
        // If token is not found, redirect to the login page
        window.location.href = '/login.html'
      }

      // Fetch user details using the token
      fetch('https://tancet-api.vercel.app/dashboard', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          Authorization: token,
        },
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            const userDetails = data
            // Display user details on the page
            document.getElementById('userDetails').innerHTML = `
            <p>Name: ${userDetails.name}</p>
                    <p>Register Number: ${userDetails.rno}</p>
      <p>Course(s): ${
        userDetails.courseid === 1 ? 'MCA' : userDetails.courseid === 2 ? 'MBA' : userDetails.courseid === 3 ? 'MCA, MBA' : 'Unknown'
      }</p>
                    <!-- Add more user details here -->
                `
                console.log(userDetails.courseid)
          } else {
            // Redirect to login page if not authenticated
            localStorage.removeItem('token')
            window.location.href = '/login.html'
          }
        })
        .catch((error) => console.error('Error fetching user details:', error))
    </script>
  </body>
</html>
